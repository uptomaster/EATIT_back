<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="myStoreFavorite">

  <!-- ì°œ ëª©ë¡ ì¡°íšŒ -->
  <select id="MyFavSelectAll" resultType="com.bapseguen.app.dto.StoreFavoriteDTO" parameterType="map">
  <![CDATA[
    SELECT * FROM (
      SELECT ROWNUM AS RNUM, SUBQUERY.*
      FROM (
        SELECT 
          F.FAVORITE_NUMBER,
          F.MEMBER_NUMBER,
          F.BUSINESS_NUMBER,
          S.STORE_NAME        AS storeName,
          S.STORE_ADDRESS     AS storeAddress,
          S.STORE_OPEN_TIME   AS openTime,
          S.STORE_CLOSE_TIME  AS closeTime,
          (SELECT SI.STORE_IMAGE_SYSTEM_NAME
             FROM TBL_STORE_IMAGE SI
            WHERE SI.BUSINESS_NUMBER = F.BUSINESS_NUMBER
              AND ROWNUM = 1) AS storeImageSystemName
        FROM TBL_STORE_FAVORITE F
        JOIN TBL_STORE S ON F.BUSINESS_NUMBER = S.BUSINESS_NUMBER
        WHERE F.MEMBER_NUMBER = #{memberNumber}
        ORDER BY F.FAVORITE_NUMBER DESC
      ) SUBQUERY
    )
    WHERE RNUM BETWEEN #{startRow} AND #{endRow}
  ]]>
  </select>

  <!-- ì°œ ì—¬ë¶€ í™•ì¸ -->
  <select id="exists" parameterType="map" resultType="int">
    SELECT COUNT(*)
    FROM TBL_STORE_FAVORITE
    WHERE MEMBER_NUMBER = #{memberNumber}
      AND BUSINESS_NUMBER = #{businessNumber}
  </select>

  <!-- ðŸ“Œ íšŒì›ë³„ ì°œ ê°œìˆ˜ -->
  <select id="countByMember" parameterType="int" resultType="int">
    SELECT COUNT(*)
    FROM TBL_STORE_FAVORITE
    WHERE MEMBER_NUMBER = #{memberNumber}
  </select>

  <!-- ì°œ ì¶”ê°€ -->
  <insert id="MyFavInsert" parameterType="com.bapseguen.app.dto.StoreFavoriteDTO">
    INSERT INTO TBL_STORE_FAVORITE (
      FAVORITE_NUMBER, MEMBER_NUMBER, BUSINESS_NUMBER
    ) VALUES (
      SEQ_STORE_FAVORITE_NUMBER.NEXTVAL, #{memberNumber}, #{businessNumber}
    )
  </insert>

  <!-- ì°œ í•´ì œ -->
  <delete id="MyFavDelete" parameterType="com.bapseguen.app.dto.StoreFavoriteDTO">
    DELETE FROM TBL_STORE_FAVORITE
    WHERE MEMBER_NUMBER = #{memberNumber}
      AND BUSINESS_NUMBER = #{businessNumber}
  </delete>

</mapper>
