<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="faq">

	<!-- 자주묻는질문(faq) 목록 조회 -->
	<select id="faqSelectAll" resultType="FaqDTO">
		SELECT * FROM (
		SELECT
		ROWNUM AS RNUM, SUBQUERY.*
		FROM (
		SELECT
		POST_NUMBER,POST_TITLE,POST_CREATED_DATE,POST_VIEW_COUNT,POST_TYPE
		FROM TBL_POST
		WHERE POST_TYPE = 'FAQ'
		AND POST_DELETE_STATE = 'N'
		ORDER
		BY POST_CREATED_DATE DESC
		) SUBQUERY
		)
		WHERE RNUM BETWEEN #{startRow} AND
		#{endRow}
	</select>

	<select id="faqListCount" resultType="int">
		SELECT COUNT(*)
		FROM TBL_FAQ
	</select>

	<!--조회수 쿼리 -->
	<update id="updateReadCount" parameterType="int">
		UPDATE TBL_POST
		SET
		POST_READ_COUNT=POST_READ_COUNT+1
		WHERE POST_NUMBER=#{postNumber}
	</update>

	<!-- 자주묻는질문 상세(1건조회) -->
	<select id="faqSelect" parameterType="int" resultType="FaqDTO">
		<![CDATA[
			SELECT P.POST_NUMBER, P.POST_TITLE, P.POST_LIKE_COUNT, P.POST_CREATED_DATE, P.POST_VIEW_COUNT, FAQ_CONTENT
			FROM TBL_POST P JOIN TBL_FAQ F
			ON P.POST_NUMBER = F.POST_NUMBER
			WHERE P.POST_NUMBER= #{postNumber}
		]]>
	</select>

	<!-- 게시글 검색 -->
	<select id="searchFaq" parameterType="string"
		resultType="FaqDTO">
		<![CDATA[
  SELECT P.POST_NUMBER, P.POST_TITLE, P.POST_CREATED_DATE, P.POST_VIEW_COUNT, P.POST_LIKE_COUNT
  FROM TBL_POST P
  WHERE P.POST_TYPE = 'FAQ'
    AND P.POST_DELETE_STATE = 'N'
    AND LOWER(P.POST_TITLE) LIKE '%' || LOWER(#{query}) || '%'
  ORDER BY P.POST_CREATED_DATE DESC
			]]>
	</select>

</mapper>